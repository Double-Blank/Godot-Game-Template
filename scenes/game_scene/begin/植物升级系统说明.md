# 植物升级系统使用说明

## 系统概述

植物升级系统为游戏中的植物提供了7个不同的生长阶段，每个阶段都有独特的外观和属性。系统支持阶段间的平滑过渡动画，并允许外部脚本控制植物的生长。

## 生长阶段

### 阶段0: 发芽 (GERMINATION)
- **描述**: 根部开始生长
- **资源**: Spine2D动画 (`res://scenes/game_scene/begin/plant-stage-0/plat_root.tres`)
- **射击间隔**: 2.0秒
- **特点**: 植物的初始阶段，基础防御能力

### 阶段1: 绿色草本幼苗 (SEEDLING)
- **描述**: 叶子开始生长
- **资源**: Spine2D动画 (`res://scenes/game_scene/begin/plant-stage-1/plant-leaves.tres`)
- **射击间隔**: 1.8秒
- **特点**: 射击频率略有提升

### 阶段2: 绿色香草蔬菜 (VEGETATIVE)
- **描述**: 叶子开始繁茂
- **资源**: 图片占位符 (`res://scenes/game_scene/begin/plant-stage-2/plant-stage-2.png`)
- **射击间隔**: 1.5秒
- **特点**: 防御能力进一步增强

### 阶段3: 开花前 (PRE_FLOWERING)
- **描述**: 植株长出花苞
- **资源**: 图片占位符 (`res://scenes/game_scene/begin/plant-stage-3/plant-stage-3.png`)
- **射击间隔**: 1.2秒
- **特点**: 射击频率显著提升

### 阶段4: 花期 (FLOWERING)
- **描述**: 植株开花
- **资源**: 图片占位符 (`res://scenes/game_scene/begin/plant-stage-4/plant-stage-4.png`)
- **射击间隔**: 1.0秒
- **特点**: 高频率射击

### 阶段5: 结果 (FRUITING)
- **描述**: 植株长出果实
- **资源**: 图片占位符 (`res://scenes/game_scene/begin/plant-stage-5/plant-stage-5.png`)
- **射击间隔**: 0.8秒
- **特点**: 最高射击频率

### 阶段6: 死亡 (DEATH)
- **描述**: 植株枯萎
- **资源**: 图片占位符 (`res://scenes/game_scene/begin/plant-stage-6/plant-stage-6.png`)
- **射击间隔**: 停止射击
- **特点**: 植物无法继续战斗

## 核心组件

### 1. PlantGrowthManager (植物生长管理器)
- **文件**: `plant_growth_manager.gd`
- **功能**: 管理植物的生长阶段切换和显示
- **主要方法**:
  - `set_stage(new_stage, play_transition)`: 设置植物阶段
  - `next_stage()`: 进入下一个生长阶段
  - `die()`: 直接跳转到死亡阶段
  - `is_alive()`: 检查植物是否存活
  - `can_advance()`: 检查是否可以进入下一阶段

### 2. PlantTower (植物塔)
- **文件**: `plant_tower.gd`
- **功能**: 整合生长管理器和战斗逻辑
- **主要方法**:
  - `grow_plant()`: 让植物进入下一个生长阶段
  - `kill_plant()`: 直接杀死植物
  - `get_current_stage()`: 获取当前植物生长阶段
  - `get_stage_name()`: 获取当前阶段名称

### 3. PlantGrowthUI (植物生长UI)
- **文件**: `plant_growth_ui.gd`
- **功能**: 提供用户界面控制植物生长
- **UI元素**:
  - 生长按钮: 点击让植物进入下一阶段
  - 杀死按钮: 直接让植物死亡
  - 阶段标签: 显示当前阶段信息
  - 状态标签: 显示植物存活状态

## 使用方法

### 基本使用
1. 在场景中实例化 `plant_component.tscn`
2. 植物会自动从发芽阶段开始
3. 使用UI按钮或脚本控制植物生长

### 脚本控制示例
```gdscript
# 获取植物组件
var plant = get_node("PlantComponent")

# 让植物生长到下一阶段
plant.grow_plant()

# 直接杀死植物
plant.kill_plant()

# 获取当前阶段
var current_stage = plant.get_current_stage()
var stage_name = plant.get_stage_name()

# 检查植物状态
var growth_manager = plant.get_node("PlantGrowthManager")
if growth_manager.is_alive() and growth_manager.can_advance():
    plant.grow_plant()
```

### 信号连接
```gdscript
# 连接植物生长管理器的信号
var growth_manager = plant.get_node("PlantGrowthManager")
growth_manager.stage_changed.connect(_on_plant_stage_changed)
growth_manager.transition_completed.connect(_on_plant_transition_completed)

func _on_plant_stage_changed(old_stage, new_stage):
    print("植物从阶段 %d 变为阶段 %d" % [old_stage, new_stage])

func _on_plant_transition_completed(stage):
    print("植物过渡到阶段 %d 完成" % stage)
```

## 扩展功能

### 添加新的生长阶段
1. 在 `PlantGrowthManager.GrowthStage` 枚举中添加新阶段
2. 在 `plant_component.tscn` 中添加对应的显示节点
3. 在 `setup_stage_nodes()` 方法中添加节点引用
4. 在 `get_stage_name()` 方法中添加阶段名称
5. 在 `plant_tower.gd` 的 `_on_plant_stage_changed()` 中添加阶段属性

### 自定义过渡动画
修改 `PlantGrowthManager` 中的 `play_transition_animation()` 方法来实现自定义过渡效果。

### 添加阶段特殊能力
在 `plant_tower.gd` 的 `_on_plant_stage_changed()` 方法中为不同阶段添加特殊能力，如：
- 不同的子弹类型
- 特殊攻击模式
- 防御加成
- 生命值恢复

## 注意事项

1. **资源路径**: 确保所有图片和Spine资源路径正确
2. **节点命名**: PlantGrowthManager中的子节点命名必须与setup_stage_nodes()中的查找逻辑一致
3. **信号连接**: 确保在适当的时机连接信号，避免空引用
4. **性能考虑**: 大量植物实例时，考虑对象池化和LOD系统
5. **保存/加载**: 如需保存游戏状态，记得保存植物的当前阶段

## 文件结构
```
scenes/game_scene/begin/
├── plant_growth_manager.gd      # 生长管理器脚本
├── plant_tower.gd               # 植物塔脚本
├── plant_component.tscn         # 植物组件场景
├── plant_growth_ui.gd           # UI控制脚本
├── plant_growth_ui.tscn         # UI场景
├── plant-stage-0/               # 发芽阶段资源
├── plant-stage-1/               # 幼苗阶段资源
├── plant-stage-2/               # 繁茂阶段资源
├── plant-stage-3/               # 花苞阶段资源
├── plant-stage-4/               # 开花阶段资源
├── plant-stage-5/               # 结果阶段资源
└── plant-stage-6/               # 死亡阶段资源
